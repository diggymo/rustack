<svg host="65bd71144e" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="951px" height="771px" viewBox="-0.5 -0.5 951 771" content="&lt;mxfile&gt;&lt;diagram id=&quot;aul5IFUKA8XRQZymiXtf&quot; name=&quot;ページ1&quot;&gt;5VpLb+M2EP41BJJDDImyXkfRsreXbgukQLunhWIzthDZciU5TnrY394hOZSoh2Nn7U3SboDY5PA1/DiPj4SJM1k/fSqS7erXfMEzQq3FE3FiQqkXevApBM9KMPapEiyLdKFEdiO4Tf/hKLRQuksXvGx1rPI8q9JtWzjPNxs+r1qypCjyfbvbfZ61V90mS94T3M6TrC/9M11UKyUNqN/If+HpcqVXtr1Qtdwl84dlke82uB6hzkz+qeZ1oufCjZarZJHvDZEzJc6kyPNKldZPE54JaDVsatzsQGutd8E31SkDKOpdVs9673wBUGB1k2/gi62qdQY1G4r8Ka3+grI1crH2xWiJhQFYuvKsK5uqeFaDqKvrX8zGZpys6YH93eAGy3xXzFFfB6GskmLJsZvjKpnYizEQMfjE8zWHdaBDwbOkSh/bx56g9Szrfg2CUEAQhwHV2jwm2Q5nBf1L/nWfFwtCvQw0ZHcFlJaV3OEhSblNNq2D8f7eCatg9/mmuimly0TQwba3T3KYYXs38zzLC9VeLO+uqAt4gOqWWbhWi+Gs9fI+I1OHBDaJpmTqksgibCwKoUWCQDZZonUaEDYjLBZNQSS6od4AkFL9Y2xnCkpOtOYOiRgWQKgK2EQJC3VhppsclEQzjYmvC7UkwkIwNnDDzndZPn/QKoRHEBImMIDPHdgNL0wIHpPi6ubGlKu9W4eg7IHy3iYWn2JiCJ48gBBcE4fInsGMQIqBApuSUJ8JFhzZpE47PnCSYkYOLnrY/T6aGXskhN1aEq+42fMwgpQE0J9+3q1l61gYH8wgUGNtsGAG7z8FhGeJUAyf6HUMzzMIu54ZBlhgU92HvQDW7fNaz8Bei9oHw6h/lqh9rIGA4DcmjJHIxa2iyxwxqN+23w3RCYbV4SESBr5AKrBfpRW/3SYy6++BdLZpSZKlyw2UM37fTDZAHB55UfGnFykBtjreWA1BCkstzOz7hhA6FvLclUkGNQU4i0bYPTyO8LKGY1lW0CJZo/ERmiVrv/MiBTV58SruRQe4l/Vu3Ise4F53STVfnWdgF7Aoe2y1LKquGxZl64uBaVHeJQzK+W6DahuT7x6xptMMZ/yhDGd8wHDSDThEMpeLfTTzcQYC0o8zH7eH0HB0b1KETtGRozPDrM7Vj+sRsNhyKIm7gv0dZHmQjuhnefinLSSniQlzJIMKhVAkrqnsE5DIlrkQGScz6Xog2gNfEnxXzBTEeihIfKFTFBpJMxS6RtRgapr2ty4KSilIvoFkp3CLivSlRJBSMQ9sCLItzBNNQMGXk+i78dHTCcWsrBIk8oI4bHfl6ur6f0MLnLDvhZ79w2iB13NDjdvKbh3O0VuQtnJfGIUtDpuI4CFq8oLWsd6pdJdQ2LY46alwHVzH7a4DA5vDNPRC4VYL7JFYDMKTr3h9TeonBxaz9WLUdFsIJvKuWLaGd14nhofLO0HPFCnqZV9Eq1GWlBVYvOkA/TUdXJO+4ZpjjT+9DP6Dq3YeYI5YpStCX+B2H1eMN5WhSDsY0fvKdl5rOs8yDS5ubZfxxXFRQd68l4JW+gkqqF85vHbQFAkHts7ktQtMFpbrae2NZKAUw0BjERss4gp3lmntCso2RnX1ZUZ1M8S78XWz5ShoI2c6DDj39mCYhnBatWNxWRX5A5+onKMJ532aZR0RRP95ulmCwG1qf+QQ2eMbeijm5xDB7zP5kr5KFwsOQZ+1M8UFYn+HgLluP/S79gABq5nbWaHfv3jop7NERvvhDECtBb8XSuP/26YEodt5vtf1oIukBAXWN4Tokgqy+rnT8DrjMeXMDej8Is70PLUN4h6JvIHhxQTm2nigU8xwJrmiersMXlIczYV18DGvCMI0apxa59G8AHqEeTrp2M0b/xAytT/0Y6cbq1Apt1w3+CxRpLne+Te5Zx97IxnpTHQ43eg0fK7Bv3CjGnwuN2dRL30T45ZU+82JyfW14DpvhK77k6IrwXorkH9aSuC0KYHvnEoJgtdTAqg2PwyQbcaPL5zpvw==&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);">
    <defs/>
    <g>
        <path d="M 487 190 L 487.89 243.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 487.98 248.88 L 484.37 241.94 L 487.89 243.63 L 491.36 241.82 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="334" y="60" width="306" height="130" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 304px; height: 1px; padding-top: 125px; margin-left: 336px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                parse_word
                                <br/>
                                <br/>
                                <span style="font-size: 11px; background-color: rgb(255, 255, 255);">
                                    {の場合、追加
                                </span>
                                <span style="font-size: 11px; background-color: rgb(255, 255, 255);">
                                    （ルートスタックではないのでblock）
                                </span>
                                <br style="border-color: var(--border-color); font-size: 11px;"/>
                                <span style="font-size: 11px; background-color: rgb(255, 255, 255);">
                                    }の場合、blockを1つ取得しブロックをeval
                                    <br/>
                                </span>
                                <span style="font-size: 11px; background-color: rgb(255, 255, 255);">
                                    数字の場合→Num変換してeval
                                    <br/>
                                </span>
                                <span style="font-size: 11px; background-color: rgb(255, 255, 255);">
                                    `/`からはじまる場合→Symに変換してeval
                                </span>
                                <span style="font-size: 11px; background-color: rgb(255, 255, 255);">
                                    <br/>
                                    それ以外の場合→Opに変換してeval
                                    <br/>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="336" y="129" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">
                    parse_word...
                </text>
            </switch>
        </g>
        <path d="M 230 59.56 L 330.74 109.19" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 335.45 111.51 L 327.62 111.55 L 330.74 109.19 L 330.71 105.27 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="110" y="0" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 30px; margin-left: 111px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                parse_batch
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="170" y="34" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    parse_batch
                </text>
            </switch>
        </g>
        <path d="M 230 178.11 L 327.75 158.74" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 332.9 157.72 L 326.72 162.51 L 327.75 158.74 L 325.36 155.64 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="110" y="160" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 190px; margin-left: 111px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                parse_interactive
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="170" y="194" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    parse_interactive
                </text>
            </switch>
        </g>
        <rect x="334" y="250" width="616" height="130" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 614px; height: 1px; padding-top: 315px; margin-left: 336px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                eval
                                <br/>
                                Opだったらvm.varsから値取得。NativeOpだったら即時実行、Block（自前定義の関数）なら中身を順次eval
                                <br/>
                                <span style="font-size: 11px; background-color: rgb(255, 255, 255);">
                                    それ以外はstackにpush()
                                    <br/>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="336" y="319" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">
                    eval...
                </text>
            </switch>
        </g>
        <rect x="10" y="410" width="510" height="140" fill="none" stroke="none" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 502px; height: 1px; padding-top: 400px; margin-left: 15px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 150px; overflow: hidden;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <h1>
                                    ブロック（{ 1 2 + }）の評価フロー
                                </h1>
                                <p>
                                    1. `{` が評価され、vm.blocksが追加される
                                    <br/>
                                    2. `1` が評価され、vm.blocks.last()にpush
                                    <br/>
                                    3. `2` が評価され、vm.blocks.last()にpush
                                    <br/>
                                    4. `+` が評価され、vm.blocks.last()にpush（ブロック内なので関数実行されない）
                                    <br/>
                                    5. `}` が評価され、vm.blocks.last()をまとめてstackに移動
                                    <br/>
                                    6. stack = [ Block([1, 2, "+"]) となる
                                </p>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="15" y="412" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">
                    ブロック（{ 1 2 + }）の評価フロー...
                </text>
            </switch>
        </g>
        <rect x="0" y="590" width="510" height="180" fill="none" stroke="none" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 502px; height: 1px; padding-top: 580px; margin-left: 5px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 190px; overflow: hidden;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <h1>
                                    ブロック（/a { 1 2 + } def a a ）の評価フロー
                                </h1>
                                <p>
                                    1. `/a` が評価され、vm.stackに追加される
                                    <br/>
                                    2. `{ ~ }` が評価され、vm.stackにBlockとして追加される
                                    <br/>
                                    3. `def` が評価され、vm.varsに`Block({ ~ })`が保存される・vm.stackから/aと{ ~ }は消える
                                    <br/>
                                    （stack = [], vars = {a: Block({~})}, blocks = []）
                                    <br/>
                                    4. `a` が評価され、vm.varsから取得され同時に実行される
                                    <br/>
                                    （stack = [3], vars = {a: Block({~})}, blocks = []）
                                    <br/>
                                    5. `a` が評価され、vm.varsから取得され同時に実行される
                                    <br/>
                                    （stack = [3, 3], vars = {a: Block({~})}, blocks = []）
                                    <br/>
                                </p>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="5" y="592" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">
                    ブロック（/a { 1 2 + } def a a ）の評価フロー...
                </text>
            </switch>
        </g>
    </g>
    <switch>
        <g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/>
        <a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank">
            <text text-anchor="middle" font-size="10px" x="50%" y="100%">
                Text is not SVG - cannot display
            </text>
        </a>
    </switch>
</svg>